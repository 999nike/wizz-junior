<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Wizz Duo Builder</title>
  <style>
    :root{
      --bg:#0b0f14; --panel:#0f1620; --panel2:#0b111a;
      --text:#e8eef6; --muted:rgba(232,238,246,.75);
      --line:#263244; --blue:#1f6feb; --red:#d73a49;
      --radius:14px;
    }
    body{font-family:system-ui,Arial;margin:0;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:0 auto;padding:16px}
    h1{margin:0 0 12px;font-size:18px;font-weight:700}
    .grid{display:grid;grid-template-columns:420px 1fr;gap:12px}
    @media(max-width:980px){.grid{grid-template-columns:1fr}}
    .card{border:1px solid var(--line);border-radius:var(--radius);padding:12px;background:var(--panel)}
    label{display:block;font-size:12px;opacity:.9;margin:8px 0 6px}
    textarea,input,select,button{
      width:100%;padding:10px;border-radius:12px;border:1px solid var(--line);
      background:var(--panel);color:var(--text);box-sizing:border-box
    }
    textarea{min-height:110px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .row > *{flex:1}
    button{cursor:pointer;background:var(--blue);border:0;font-weight:700}
    button.secondary{background:transparent;border:1px solid var(--line)}
    button.danger{background:var(--red)}
    button:disabled{opacity:.6;cursor:not-allowed}
    .tiny{opacity:.75;font-size:12px;margin-top:8px}
    .tabs{display:flex;gap:8px;margin-top:8px}
    .tab{padding:8px 10px;border-radius:12px;border:1px solid var(--line);background:transparent;cursor:pointer;font-weight:700}
    .tab.active{background:var(--panel2)}
    .chat-split{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:980px){.chat-split{grid-template-columns:1fr}}
    .chat-title{font-size:12px;opacity:.8;margin-bottom:6px}
    .chatbox{
      border:1px solid var(--line);border-radius:12px;padding:10px;
      min-height:260px;max-height:460px;overflow:auto;background:var(--panel2)
    }
    .bubble{
      padding:9px 10px;border-radius:12px;margin:8px 0;
      white-space:pre-wrap;word-break:break-word;border:1px solid var(--line);
      background:var(--panel)
    }
    .bubble.meta{opacity:.85}
    .typing{opacity:.7;font-size:12px;margin:6px 0}
    .status{font-size:12px;opacity:.85;margin-top:10px}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid var(--line);font-size:12px;opacity:.9}
    .divider{height:1px;background:var(--line);margin:10px 0}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Wizz Duo Builder <span class="pill">Web Page Generator + Publisher</span></h1>

    <div class="grid">
      <div class="card">
        <label>Mode</label>
        <select id="mode">
          <option value="web_duo" selected>Build Web Page (WS → WJ → WS)</option>
          <option value="ws">WS only</option>
          <option value="wj">WJ only</option>
        </select>

        <label>Goal</label>
        <textarea id="goal" placeholder="Example: Build a clean landing page to promote Junkz Shooter."></textarea>

        <label>Context (optional)</label>
        <textarea id="context" placeholder="Tone, audience, sections, features, pricing/credit pitch, etc. Short is better."></textarea>
<div class="divider"></div>

<label>Repo / Project Label (local only)</label>
<input id="repoLabel" placeholder="Example: 999nike/junkz-shooter-landing (main)" />
<div class="tiny">
  Saved to your browser only (localStorage). This does NOT change where publishing goes.
</div>

<div class="divider"></div>

<label>Publish to GitHub Repo (server-side)</label>
<div class="tiny">
  Uses Vercel env vars: <span class="mono">GITHUB_TOKEN, GITHUB_OWNER, GITHUB_REPO, GITHUB_BRANCH</span>.
  Token never touches the browser.
</div>

        <div class="row" style="margin-top:10px;">
          <button id="send">Build</button>
          <button id="publish" class="secondary" title="Build + commit files into target repo">Build + Publish</button>
        </div>

        <div class="tiny">
          Tip: Keep goals concrete. Example sections: Hero, Trailer, Screenshots, Features, Roadmap, Contact.
        </div>
      </div>

      <div class="card">
        <div class="row" style="align-items:center">
          <div style="flex:2">
            <strong>Duo Conversation</strong>
            <div class="tiny">Clean output only. Toggle Dev Log if you want internals.</div>
          </div>
          <div style="flex:1;text-align:right">
            <div class="tabs" style="justify-content:flex-end">
              <button id="tabChat" class="tab active" type="button">Chat</button>
              <button id="tabDev" class="tab" type="button">Dev Log</button>
            </div>
          </div>
        </div>

        <div id="paneChat" style="margin-top:10px;">
          <div class="chat-split">
            <div>
              <div class="chat-title">WS (Senior)</div>
              <div id="chatWS" class="chatbox"></div>
            </div>
            <div>
              <div class="chat-title">WJ (Junior)</div>
              <div id="chatWJ" class="chatbox"></div>
            </div>
          </div>
          <div class="status" id="status"></div>
        </div>

        <div id="paneDev" style="margin-top:10px;display:none">
          <div class="chat-title">Raw JSON (for debugging)</div>
          <div id="dev" class="chatbox mono"></div>
        </div>
      </div>
    </div>
  </div>

<script>
const $ = (id) => document.getElementById(id);
const sleep = (ms) => new Promise((r) => setTimeout(r, ms));

// ---------------------------
// Local-only UI preferences
// ---------------------------
const LS_KEYS = {
  repoLabel: "wizzduo_repoLabel_v1"
};

function loadLocalPrefs(){
  const el = $("repoLabel");
  if (!el) return;

  const saved = localStorage.getItem(LS_KEYS.repoLabel);
  if (saved) el.value = saved;

  // Save on change (lightweight + reliable)
  el.addEventListener("input", () => {
    localStorage.setItem(LS_KEYS.repoLabel, el.value.trim());
  });
}

function setStatus(txt){ const el=$("status"); if(el) el.textContent = txt || ""; }
function clearUI(){
  $("chatWS").innerHTML = "";
  $("chatWJ").innerHTML = "";
  $("dev").textContent = "";
  setStatus("");
}
function addBubble(el, text, cls=""){
  const d=document.createElement("div");
  d.className="bubble"+(cls?" "+cls:"");
  d.textContent=text;
  el.appendChild(d);
  el.scrollTop = el.scrollHeight;
}
async function typeLine(el, label){
  const t=document.createElement("div");
  t.className="typing";
  t.textContent=label;
  el.appendChild(t);
  el.scrollTop = el.scrollHeight;
  await sleep(350);
  t.remove();
}
function setTab(which){
  const chatBtn=$("tabChat"), devBtn=$("tabDev");
  const chatPane=$("paneChat"), devPane=$("paneDev");
  const chatOn = which === "chat";
  chatBtn.classList.toggle("active", chatOn);
  devBtn.classList.toggle("active", !chatOn);
  chatPane.style.display = chatOn ? "" : "none";
  devPane.style.display  = chatOn ? "none" : "";
}
$("tabChat").addEventListener("click", ()=>setTab("chat"));
$("tabDev").addEventListener("click", ()=>setTab("dev"));

async function run({ publish=false }){
  const mode = $("mode").value;
  const goal = $("goal").value.trim();
  const context = $("context").value.trim();
  if (!goal) return;

  $("send").disabled = true;
  $("publish").disabled = true;
  clearUI();
  setStatus(publish ? "Building + publishing..." : "Building...");

  try {
    let url = "/api/duo";
    let payload = { goal, context, mode, publish };

    if (mode === "ws") { url = "/api/ws"; payload = { goal, context }; }
    if (mode === "wj") { url = "/api/wj"; payload = { task: goal, context }; }

    const res = await fetch(url, {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify(payload)
    });

    const raw = await res.text();
    let data=null; try{ data=JSON.parse(raw); }catch{}

    if(!res.ok){
      addBubble($("chatWS"), "ERROR:\n" + (data?.error || raw || "Unknown error"), "meta");
      $("dev").textContent = raw || "";
      setStatus("Error.");
      return;
    }
    if(!data){
      addBubble($("chatWS"), "ERROR:\nServer returned non-JSON:\n" + raw, "meta");
      $("dev").textContent = raw || "";
      setStatus("Error.");
      return;
    }

    // Dev log always available
    $("dev").textContent = JSON.stringify(data, null, 2);

    // Duo web build flow
    if(mode === "web_duo"){
      const wsEl=$("chatWS"), wjEl=$("chatWJ");

      await typeLine(wsEl, "WS is planning...");
      if (data.ws_plan_summary) addBubble(wsEl, data.ws_plan_summary, "meta");

      await typeLine(wjEl, "WJ is building files...");
      if (Array.isArray(data.files_built)){
        addBubble(wjEl, "FILES BUILT:\n" + data.files_built.map(f=>"- "+f).join("\n"), "meta");
      }

      await typeLine(wsEl, "WS is reviewing...");
      if (data.final_summary) addBubble(wsEl, data.final_summary);

      if (data.publish_status){
        addBubble(wsEl, "PUBLISH:\n" + data.publish_status, "meta");
      }

      setStatus("Done.");
      return;
    }

    // WS-only / WJ-only fallback rendering
    addBubble($("chatWS"), JSON.stringify(data, null, 2), "meta");
    setStatus("Done.");
  } catch(e){
    addBubble($("chatWS"), "CLIENT ERROR:\n" + String(e), "meta");
    setStatus("Error.");
  } finally {
    $("send").disabled = false;
    $("publish").disabled = false;
  }
}

$("send").addEventListener("click", ()=>run({ publish:false }));
$("publish").addEventListener("click", ()=>run({ publish:true }));
loadLocalPrefs();

  
<!-- ERUDA: Always-on + Settings button -->
<script src="https://unpkg.com/eruda/eruda.min.js"></script>
<script>
(function () {
  // Init Eruda
  try {
    if (window.eruda && typeof eruda.init === "function") eruda.init();
  } catch (_) {}

  // ------- Floating settings button (move + toggle) -------
  const KEY_POS = "wizz_eruda_btn_pos_v1"; // "br" | "bl" | "tr" | "tl"
  const KEY_ON  = "wizz_eruda_open_v1";    // "1" or "0"

  function posToStyle(pos) {
    const base = {
      position: "fixed",
      zIndex: 999999,
      padding: "10px 12px",
      borderRadius: "999px",
      border: "1px solid rgba(255,255,255,.25)",
      background: "rgba(15,22,32,.92)",
      color: "#fff",
      font: "12px system-ui, Arial",
      cursor: "pointer",
      userSelect: "none"
    };

    // default bottom-right
    base.right = "12px";
    base.bottom = "12px";

    if (pos === "bl") { delete base.right; base.left = "12px"; base.bottom = "12px"; }
    if (pos === "tr") { delete base.bottom; base.right = "12px"; base.top = "12px"; }
    if (pos === "tl") { delete base.right; delete base.bottom; base.left = "12px"; base.top = "12px"; }

    return base;
  }

  function applyStyle(el, styleObj) {
    el.style.cssText = Object.entries(styleObj).map(([k,v]) => `${k.replace(/[A-Z]/g,m=>"-"+m.toLowerCase())}:${v}`).join(";");
  }

  const btn = document.createElement("button");
  btn.type = "button";
  btn.textContent = "⚙ Debug";
  document.body.appendChild(btn);

  let pos = localStorage.getItem(KEY_POS) || "br";
  applyStyle(btn, posToStyle(pos));

  function setOpen(open) {
    localStorage.setItem(KEY_ON, open ? "1" : "0");
    try {
      if (!window.eruda) return;
      if (open) eruda.show(); else eruda.hide();
    } catch (_) {}
    btn.textContent = open ? "⚙ Debug (ON)" : "⚙ Debug";
  }

  const openSaved = localStorage.getItem(KEY_ON) === "1";
  setOpen(openSaved);

  // Tap = toggle open/close
  btn.addEventListener("click", () => {
    const isOn = localStorage.getItem(KEY_ON) === "1";
    setOpen(!isOn);
  });

  // Long-press = move corner (cycles positions)
  let pressTimer = null;
  btn.addEventListener("touchstart", () => {
    pressTimer = setTimeout(() => {
      const order = ["br", "bl", "tr", "tl"];
      const idx = order.indexOf(pos);
      pos = order[(idx + 1) % order.length];
      localStorage.setItem(KEY_POS, pos);
      applyStyle(btn, posToStyle(pos));
    }, 450);
  }, { passive: true });

  btn.addEventListener("touchend", () => {
    if (pressTimer) clearTimeout(pressTimer);
    pressTimer = null;
  });

  // Desktop support: right-click to move
  btn.addEventListener("contextmenu", (e) => {
    e.preventDefault();
    const order = ["br", "bl", "tr", "tl"];
    const idx = order.indexOf(pos);
    pos = order[(idx + 1) % order.length];
    localStorage.setItem(KEY_POS, pos);
    applyStyle(btn, posToStyle(pos));
  });
})();
</script>

</body>
</html>
